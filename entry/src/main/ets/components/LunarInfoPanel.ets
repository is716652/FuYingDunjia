/**
 * LunarInfoPanel å†œå†ä¿¡æ¯é¢æ¿ç»„ä»¶
 * 
 * åŠŸèƒ½ï¼š
 * - æ˜¾ç¤ºå†œå†æ—¥æœŸï¼ˆå†œå†å¹´æœˆæ—¥ï¼‰
 * - æ˜¾ç¤ºç”Ÿè‚–
 * - æ˜¾ç¤ºèŠ‚æ°”èŠ‚æ—¥ä¿¡æ¯ï¼ˆåŒ…å«äº¤èŠ‚æ—¶åˆ»ï¼‰
 * 
 * ä½¿ç”¨ç¤ºä¾‹ï¼š
 * LunarInfoPanel({
 *   lunarYear: this.dayInfo.lunar_year,
 *   lunarMonth: this.dayInfo.lunar_month,
 *   lunarDay: this.dayInfo.lunar_day,
 *   zodiac: this.dayInfo.zodiac,
 *   solarTerm: this.dayInfo.solar_term,
 *   solarTermTime: this.dayInfo.solar_term_time,
 *   festivals: this.dayInfo.festivals
 * })
 */

import { SolarTermCalculator, SolarTermInfo } from '../utils/SolarTermCalculator';

@Component
export struct LunarInfoPanel {
  @Prop lunarYear: string = '';
  @Prop lunarMonth: number = 1;
  @Prop lunarDay: number = 1;
  @Prop zodiac: string = '';
  @Prop yearGan: string = '';  // å¹´å¹²
  @Prop yearZhi: string = '';  // å¹´æ”¯
  @Prop monthGan: string = '';  // æœˆå¹²
  @Prop monthZhi: string = '';  // æœˆæ”¯
  @Prop dayGan: string = '';  // æ—¥å¹²
  @Prop dayZhi: string = '';  // æ—¥æ”¯
  @Prop shiGan: string = '';  // æ—¶å¹²
  @Prop shiZhi: string = '';  // æ—¶æ”¯
  @Prop solarTerm: string = '';
  @Prop solarTermTime: SolarTermInfo | null = null;
  @Prop festivals: string = '';

  build() {
    Column({ space: 12 }) {
      // å†œå†ä¿¡æ¯
      Column({ space: 8 }) {
        Text('ğŸ“… å†œå†ä¿¡æ¯')
          .fontSize(16)
          .fontWeight(FontWeight.Bold)
          .fontColor('#2C2416')
          .width('100%')
        
        // å†œå†æ—¥æœŸ - æ”¾å¤§æ˜¾ç¤º
        Text(`${this.lunarYear}å¹´ ${this.getLunarMonth()}${this.getLunarDay()}`)
          .fontSize(20)
          .fontWeight(FontWeight.Medium)
          .fontColor('#2C2416')
          .width('100%')
          .margin({ top: 4 })
        
        Text(`ç”Ÿè‚–ï¼š${this.zodiac}`)
          .fontSize(16)
          .fontColor('#666666')
          .width('100%')
          .margin({ top: 4 })
        
        // å››æŸ±å…«å­—
        Text(`${this.yearGan}${this.yearZhi}å¹´ ${this.monthGan}${this.monthZhi}æœˆ ${this.dayGan}${this.dayZhi}æ—¥ ${this.shiGan}${this.shiZhi}æ—¶`)
          .fontSize(18)
          .fontWeight(FontWeight.Medium)
          .fontColor('#D4A574')
          .width('100%')
          .margin({ top: 8 })
      }
      .width('100%')
      .padding(12)
      .backgroundColor('#ffffff')
      .borderRadius(8)
      .border({ width: 1, color: '#eeeeee' })

      // èŠ‚æ°”èŠ‚æ—¥
      if (this.solarTerm || this.festivals) {
        Column({ space: 8 }) {
          Text('ğŸŒ¸ èŠ‚æ°”èŠ‚æ—¥')
            .fontSize(16)
            .fontWeight(FontWeight.Bold)
            .fontColor('#2C2416')
            .width('100%')
          
          // èŠ‚æ—¥ä¿¡æ¯
          if (this.festivals) {
            Text(`èŠ‚æ—¥ï¼š${this.festivals}`)
              .fontSize(14)
              .fontColor('#666666')
              .width('100%')
          }
          
          // èŠ‚æ°”ä¿¡æ¯åŠç²¾ç¡®æ—¶åˆ»
          if (this.solarTerm) {
            Column({ space: 4 }) {
              Text(`èŠ‚æ°”ï¼š${this.solarTerm}`)
                .fontSize(14)
                .fontColor('#666666')
                .width('100%')
              
              // æ˜¾ç¤ºèŠ‚æ°”ç²¾ç¡®æ—¶åˆ»
              if (this.solarTermTime) {
                Row({ space: 4 }) {
                  Text('â° äº¤èŠ‚æ—¶åˆ»ï¼š')
                    .fontSize(13)
                    .fontColor('#999999')
                  Text(SolarTermCalculator.formatSolarTermTime(this.solarTermTime).split(' ')[1])
                    .fontSize(13)
                    .fontWeight(FontWeight.Medium)
                    .fontColor('#D4A574')
                }
              }
            }
          }
        }
        .width('100%')
        .padding(12)
        .backgroundColor('#ffffff')
        .borderRadius(8)
        .border({ width: 1, color: '#eeeeee' })
      }
    }
    .width('100%')
  }

  getLunarMonth(): string {
    const months = ['æ­£æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ', 
                    'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'å†¬æœˆ', 'è…Šæœˆ'];
    return months[this.lunarMonth - 1] || `${this.lunarMonth}æœˆ`;
  }

  getLunarDay(): string {
    const days = ['åˆä¸€', 'åˆäºŒ', 'åˆä¸‰', 'åˆå››', 'åˆäº”', 'åˆå…­', 'åˆä¸ƒ', 'åˆå…«', 'åˆä¹', 'åˆå',
                  'åä¸€', 'åäºŒ', 'åä¸‰', 'åå››', 'åäº”', 'åå…­', 'åä¸ƒ', 'åå…«', 'åä¹', 'äºŒå',
                  'å»¿ä¸€', 'å»¿äºŒ', 'å»¿ä¸‰', 'å»¿å››', 'å»¿äº”', 'å»¿å…­', 'å»¿ä¸ƒ', 'å»¿å…«', 'å»¿ä¹', 'ä¸‰å'];
    return days[this.lunarDay - 1] || `${this.lunarDay}æ—¥`;
  }
}
