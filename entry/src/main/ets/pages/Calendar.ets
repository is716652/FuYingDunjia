import { CalendarManager, CalendarDayInfo } from '../utils/CalendarManager';
import { ShichenHelper } from '../utils/ShichenHelper';
import { SolarTimeHelper, CHINA_CITY_LONGITUDES } from '../utils/SolarTimeHelper';
import { SolarTermCalculator } from '../utils/SolarTermCalculator';
import { router } from '@kit.ArkUI';
import { NavigationBar } from '../components/NavigationBar';
import { CalendarHeader } from '../components/CalendarHeader';

interface SelectOption {
  value: string;
}

interface DayCell {
  day: number;          // æ—¥æœŸæ•°å­—
  isCurrentMonth: boolean;  // æ˜¯å¦å½“æœˆ
  date: Date;           // å®Œæ•´æ—¥æœŸå¯¹è±¡
}

@Entry
@Component
struct CalendarPage {
  @State dayInfo: CalendarDayInfo | null = null;
  @State selectedShichenIndex: number = 0;
  @State shichenTexts: string[] = [];
  @State showShichenPicker: boolean = false;
  @State showDatePicker: boolean = false;
  @State selectedDate: Date = new Date();
  @State currentYear: number = new Date().getFullYear();
  @State currentMonth: number = new Date().getMonth() + 1;
  @State calendarDays: DayCell[] = [];
  private weekDays: string[] = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
  private solarTimeHelper: SolarTimeHelper = new SolarTimeHelper(CHINA_CITY_LONGITUDES.BEIJING);

  aboutToAppear() {
    CalendarManager.getInstance().init(getContext(this));
    // é»˜è®¤åŠ è½½å½“å¤©æ—¥æœŸ
    const now = new Date();
    this.selectedDate = now;
    this.currentYear = now.getFullYear();
    this.currentMonth = now.getMonth() + 1;
    this.generateCalendar(this.currentYear, this.currentMonth);
    // åˆå§‹åŒ–æ—¶è®¾ç½®ä¸ºå½“å‰ç³»ç»Ÿæ—¶è¾°
    this.selectedShichenIndex = ShichenHelper.getCurrentShichenIndex();
    this.loadDateInfo(now.getFullYear(), now.getMonth() + 1, now.getDate());
  }

  // ç”Ÿæˆæ—¥å†æ•°æ®
  generateCalendar(year: number, month: number) {
    const firstDay = new Date(year, month - 1, 1);
    const lastDay = new Date(year, month, 0);
    const daysInMonth = lastDay.getDate();
    
    // è·å–æœˆä»½ç¬¬ä¸€å¤©æ˜¯å‘¨å‡  (0=å‘¨æ—¥, 1=å‘¨ä¸€...6=å‘¨å…­)
    let firstWeekDay = firstDay.getDay();
    // è½¬æ¢ä¸ºå‘¨ä¸€å¼€å§‹ (0=å‘¨ä¸€, 6=å‘¨æ—¥)
    firstWeekDay = firstWeekDay === 0 ? 6 : firstWeekDay - 1;
    
    const days: DayCell[] = [];
    
    // å¡«å……ä¸Šæœˆçš„å°¾éƒ¨æ—¥æœŸ
    if (firstWeekDay > 0) {
      const prevMonthLastDay = new Date(year, month - 1, 0).getDate();
      for (let i = firstWeekDay - 1; i >= 0; i--) {
        const day = prevMonthLastDay - i;
        const date = new Date(year, month - 2, day);
        days.push({ day, isCurrentMonth: false, date });
      }
    }
    
    // å¡«å……å½“æœˆæ—¥æœŸ
    for (let i = 1; i <= daysInMonth; i++) {
      const date = new Date(year, month - 1, i);
      days.push({ day: i, isCurrentMonth: true, date });
    }
    
    // å¡«å……ä¸‹æœˆçš„å¼€å¤´æ—¥æœŸï¼Œå‡‘æˆ’42ä¸ªæ ¼å­(6å‘¨)
    const remainingCells = 42 - days.length;
    for (let i = 1; i <= remainingCells; i++) {
      const date = new Date(year, month, i);
      days.push({ day: i, isCurrentMonth: false, date });
    }
    
    this.calendarDays = days;
  }

  // åˆ‡æ¢æœˆä»½
  changeMonth(offset: number) {
    let newMonth = this.currentMonth + offset;
    let newYear = this.currentYear;
    
    if (newMonth > 12) {
      newMonth = 1;
      newYear++;
    } else if (newMonth < 1) {
      newMonth = 12;
      newYear--;
    }
    
    this.currentMonth = newMonth;
    this.currentYear = newYear;
    this.generateCalendar(newYear, newMonth);
  }

  // é€‰ä¸­æ—¥æœŸ
  async onDaySelected(dayCell: DayCell) {
    if (!dayCell.isCurrentMonth) {
      // å¦‚æœç‚¹å‡»çš„æ˜¯ä¸Š/ä¸‹æœˆçš„æ—¥æœŸï¼Œåˆ‡æ¢æœˆä»½
      const offset = dayCell.date.getMonth() + 1 > this.currentMonth ? 1 : -1;
      this.changeMonth(offset);
    }
    
    this.selectedDate = dayCell.date;
    const year = dayCell.date.getFullYear();
    const month = dayCell.date.getMonth() + 1;
    const day = dayCell.date.getDate();
    await this.loadDateInfo(year, month, day);
  }

  // åˆ¤æ–­æ˜¯å¦ä¸ºé€‰ä¸­æ—¥æœŸ
  isSelectedDate(dayCell: DayCell): boolean {
    return dayCell.date.getFullYear() === this.selectedDate.getFullYear() &&
           dayCell.date.getMonth() === this.selectedDate.getMonth() &&
           dayCell.date.getDate() === this.selectedDate.getDate();
  }

  async loadDateInfo(year: number, month: number, day: number) {
    console.log(`[Calendar] loadDateInfo: ${year}-${month}-${day}`);
    const info = await CalendarManager.getInstance().getDayInfo(year, month, day);
    console.log(`[Calendar] getDayInfo result:`, JSON.stringify(info));
    if (info) {
      // å¼ºåˆ¶è§¦å‘çŠ¶æ€æ›´æ–°ï¼šå…ˆç½®ç©ºå†èµ‹å€¼
      this.dayInfo = null;
      this.dayInfo = info;
      console.log(`[Calendar] dayInfo updated:`, 
        `${this.dayInfo.year_gan}${this.dayInfo.year_zhi} ` +
        `${this.dayInfo.month_gan}${this.dayInfo.month_zhi} ` +
        `${this.dayInfo.day_gan}${this.dayInfo.day_zhi}`);
      // ä¸å†è‡ªåŠ¨é‡ç½®æ—¶è¾°ï¼Œä¿æŒç”¨æˆ·å·²é€‰æ‹©çš„æ—¶è¾°
      this.updateShichenOptions();
    } else {
      console.error(`[Calendar] Failed to load date info for ${year}-${month}-${day}`);
    }
  }

  async loadTodayInfo() {
    const now = new Date();
    this.selectedDate = now;
    // è¿”å›ä»Šå¤©æ—¶ï¼Œé‡ç½®ä¸ºå½“å‰ç³»ç»Ÿæ—¶è¾°
    this.selectedShichenIndex = ShichenHelper.getCurrentShichenIndex();
    await this.loadDateInfo(now.getFullYear(), now.getMonth() + 1, now.getDate());
  }

  updateShichenOptions() {
    if (!this.dayInfo) return;
    const allShichen = ShichenHelper.getAllShichen();
    this.shichenTexts = allShichen.map((sc, index) => 
      ShichenHelper.getShichenDisplayText(index, this.dayInfo!.day_gan)
    );
    console.log(`[Calendar] updateShichenOptions: dayGan=${this.dayInfo.day_gan}, ` +
      `selectedIndex=${this.selectedShichenIndex}, ` +
      `currentDisplay=${this.shichenTexts[this.selectedShichenIndex]}`);
  }

  getShizhu(): string {
    if (!this.dayInfo) return 'æš‚æ— ';
    return ShichenHelper.getShizhuInfo(this.dayInfo.day_gan, this.selectedShichenIndex);
  }

  navigateToDunjia() {
    if (!this.dayInfo) return;
    router.pushUrl({
      url: 'pages/DunjiaPanel',
      params: {
        date: this.dayInfo.date,
        year_gan: this.dayInfo.year_gan,
        year_zhi: this.dayInfo.year_zhi,
        month_gan: this.dayInfo.month_gan,
        month_zhi: this.dayInfo.month_zhi,
        day_gan: this.dayInfo.day_gan,
        day_zhi: this.dayInfo.day_zhi,
        shizhu: this.getShizhu(),
        shichen_index: this.selectedShichenIndex
      }
    });
  }

  build() {
    Column({ space: 0 }) {
      // é¡¶éƒ¨å¯¼èˆªæ 
      NavigationBar({
        title: 'éç”²ç¬¦åº”ç»',
        rightActionText: 'è¯´æ˜',
        onRightAction: () => {
          router.pushUrl({
            url: 'pages/DocsPage'
          });
        }
      });

      Scroll() {
        Column({ space: 16 }) {
          // æœˆä»½åˆ‡æ¢æ 
          CalendarHeader({
            year: this.currentYear,
            month: this.currentMonth,
            onPrevMonth: () => {
              this.changeMonth(-1);
            },
            onNextMonth: () => {
              this.changeMonth(1);
            }
          });

          // æ—¥å†ä¸»ä½“
          Column({ space: 0 }) {
            // æ˜ŸæœŸæ ‡é¢˜è¡Œ
            Row() {
              ForEach(this.weekDays, (weekDay: string) => {
                Text(weekDay)
                  .fontSize(14)
                  .fontColor('#999999')
                  .width(`${100/7}%`)
                  .textAlign(TextAlign.Center)
              })
            }
            .width('100%')
            .height(36)
            .backgroundColor('#F5F1E8')

            // æ—¥æœŸç½‘æ ¼ (6å‘¨ x 7å¤©)
            Column({ space: 0 }) {
              ForEach([0, 1, 2, 3, 4, 5], (weekIndex: number) => {
                Row({ space: 0 }) {
                  ForEach(this.calendarDays.slice(weekIndex * 7, (weekIndex + 1) * 7), (dayCell: DayCell) => {
                    this.buildDayCell(dayCell)
                  })
                }
                .width('100%')
              })
            }
            .width('100%')
          }
          .width('90%')
          .backgroundColor('#ffffff')
          .borderRadius(12)
          .border({ width: 1, color: '#eeeeee' })

          if (this.dayInfo) {
            // é€‰ä¸­æ—¥æœŸè¯¦æƒ…åŒº
            Column({ space: 12 }) {
              // æ—¥æœŸä¿¡æ¯æ ‡é¢˜
              Column({ space: 8 }) {
                Text(`${this.dayInfo.year}å¹´${this.dayInfo.month}æœˆ${this.dayInfo.day}æ—¥  ${this.dayInfo.week_name}`)
                  .fontSize(18)
                  .fontWeight(FontWeight.Bold)
                  .fontColor('#2C2416')
                
                // çœŸå¤ªé˜³æ—¶æ˜¾ç¤º - é†’ç›®æ ·å¼
                Row({ space: 8 }) {
                  Text('âš¡')
                    .fontSize(18)
                  Column({ space: 2 }) {
                    Row({ space: 4 }) {
                      Text('çœŸå¤ªé˜³æ—¶')
                        .fontSize(14)
                        .fontWeight(FontWeight.Medium)
                        .fontColor('#999999')
                      Text(this.solarTimeHelper.formatTrueSolarTime(this.selectedDate))
                        .fontSize(20)
                        .fontWeight(FontWeight.Bold)
                        .fontColor('#D4A574')
                    }
                    Text(`æœ¬åœ°æ—¶é—´${this.solarTimeHelper.getTimeDifferenceDescription(this.selectedDate)}`)
                      .fontSize(12)
                      .fontColor('#999999')
                    Text('çœŸå¤ªé˜³æ—¶è¯´æ˜')
                      .fontSize(12)
                      .fontColor('#D4A574')
                      .onClick(() => {
                        router.pushUrl({
                          url: 'pages/DocsPage'
                        });
                      })
                  }
                }
                .padding(10)
                .backgroundColor('#FFF8F0')
                .borderRadius(8)
                .width('100%')
              }

              // æ—¶è¾°é€‰æ‹©
              Column({ space: 8 }) {
                Row({ space: 8 }) {
                  Text('ğŸ• é€‰æ‹©æ—¶è¾°ï¼š')
                    .fontSize(14)
                    .fontColor('#666666')
                }

                Row() {
                  Text(this.shichenTexts[this.selectedShichenIndex] || 'è¯·é€‰æ‹©')
                    .fontSize(13)
                    .fontColor('#2C2416')
                    .layoutWeight(1)
                  Text('â–¼')
                    .fontSize(10)
                    .fontColor('#999999')
                }
                .width('100%')
                .padding(10)
                .backgroundColor('#F5F1E8')
                .borderRadius(6)
                .onClick(() => {
                  this.showShichenPicker = true;
                })
              }
              .width('100%')
              .padding(12)
              .backgroundColor('#ffffff')
              .borderRadius(8)

              // å››æŸ±å¹²æ”¯ - å…«å­—æ’åˆ—å½¢å¼
              Column({ space: 8 }) {
                Text('âš›ï¸ å››æŸ±å…«å­—')
                  .fontSize(16)
                  .fontWeight(FontWeight.Bold)
                  .fontColor('#2C2416')
                  .width('100%')
                
                // å…«å­—å››æŸ±æ’åˆ—
                Row({ space: 0 }) {
                  // å¹´æŸ±
                  Column({ space: 4 }) {
                    Text('å¹´')
                      .fontSize(12)
                      .fontColor('#999999')
                    Column({ space: 2 }) {
                      Text(this.dayInfo.year_gan)
                        .fontSize(24)
                        .fontWeight(FontWeight.Bold)
                        .fontColor('#D4A574')
                      Text(this.dayInfo.year_zhi)
                        .fontSize(24)
                        .fontWeight(FontWeight.Bold)
                        .fontColor('#8B4513')
                    }
                  }
                  .layoutWeight(1)
                  .padding(8)
                  .backgroundColor('#FFF8F0')
                  .borderRadius(8)

                  Divider()
                    .vertical(true)
                    .height(60)
                    .color('#eeeeee')
                    .strokeWidth(1)

                  // æœˆæŸ±
                  Column({ space: 4 }) {
                    Text('æœˆ')
                      .fontSize(12)
                      .fontColor('#999999')
                    Column({ space: 2 }) {
                      Text(this.dayInfo.month_gan)
                        .fontSize(24)
                        .fontWeight(FontWeight.Bold)
                        .fontColor('#D4A574')
                      Text(this.dayInfo.month_zhi)
                        .fontSize(24)
                        .fontWeight(FontWeight.Bold)
                        .fontColor('#8B4513')
                    }
                  }
                  .layoutWeight(1)
                  .padding(8)
                  .backgroundColor('#FFF8F0')
                  .borderRadius(8)

                  Divider()
                    .vertical(true)
                    .height(60)
                    .color('#eeeeee')
                    .strokeWidth(1)

                  // æ—¥æŸ±
                  Column({ space: 4 }) {
                    Text('æ—¥')
                      .fontSize(12)
                      .fontColor('#999999')
                    Column({ space: 2 }) {
                      Text(this.dayInfo.day_gan)
                        .fontSize(24)
                        .fontWeight(FontWeight.Bold)
                        .fontColor('#D4A574')
                      Text(this.dayInfo.day_zhi)
                        .fontSize(24)
                        .fontWeight(FontWeight.Bold)
                        .fontColor('#8B4513')
                    }
                  }
                  .layoutWeight(1)
                  .padding(8)
                  .backgroundColor('#FFF8F0')
                  .borderRadius(8)

                  Divider()
                    .vertical(true)
                    .height(60)
                    .color('#eeeeee')
                    .strokeWidth(1)

                  // æ—¶æŸ±
                  Column({ space: 4 }) {
                    Text('æ—¶')
                      .fontSize(12)
                      .fontColor('#999999')
                    Column({ space: 2 }) {
                      Text(this.getShizhu().substring(0, 1))
                        .fontSize(24)
                        .fontWeight(FontWeight.Bold)
                        .fontColor('#D4A574')
                      Text(this.getShizhu().substring(1, 2))
                        .fontSize(24)
                        .fontWeight(FontWeight.Bold)
                        .fontColor('#8B4513')
                    }
                  }
                  .layoutWeight(1)
                  .padding(8)
                  .backgroundColor('#FFF8F0')
                  .borderRadius(8)
                }
                .width('100%')
              }
              .width('100%')
              .padding(12)
              .backgroundColor('#ffffff')
              .borderRadius(8)
              .border({ width: 1, color: '#eeeeee' })

              // å†œå†ä¿¡æ¯
              Column({ space: 8 }) {
                Text('ğŸ“… å†œå†ä¿¡æ¯')
                  .fontSize(16)
                  .fontWeight(FontWeight.Bold)
                  .fontColor('#2C2416')
                  .width('100%')
                
                // å†œå†æ—¥æœŸ - æ”¾å¤§æ˜¾ç¤º
                Text(`${this.dayInfo.lunar_year}å¹´ ${this.getLunarMonth()}${this.getLunarDay()}`)
                  .fontSize(20)
                  .fontWeight(FontWeight.Medium)
                  .fontColor('#2C2416')
                  .width('100%')
                  .margin({ top: 4 })
                
                Text(`ç”Ÿè‚–ï¼š${this.dayInfo.zodiac}`)
                  .fontSize(16)
                  .fontColor('#666666')
                  .width('100%')
                  .margin({ top: 4 })
              }
              .width('100%')
              .padding(12)
              .backgroundColor('#ffffff')
              .borderRadius(8)
              .border({ width: 1, color: '#eeeeee' })

              // èŠ‚æ°”èŠ‚æ—¥
              if (this.dayInfo.solar_term || this.dayInfo.festivals) {
                Column({ space: 8 }) {
                  Text('ğŸŒ¸ èŠ‚æ°”èŠ‚æ—¥')
                    .fontSize(16)
                    .fontWeight(FontWeight.Bold)
                    .fontColor('#2C2416')
                    .width('100%')
                  
                  // èŠ‚æ—¥ä¿¡æ¯
                  if (this.dayInfo.festivals) {
                    Text(`èŠ‚æ—¥ï¼š${this.dayInfo.festivals}`)
                      .fontSize(14)
                      .fontColor('#666666')
                      .width('100%')
                  }
                  
                  // èŠ‚æ°”ä¿¡æ¯åŠç²¾ç¡®æ—¶åˆ»
                  if (this.dayInfo.solar_term) {
                    Column({ space: 4 }) {
                      Text(`èŠ‚æ°”ï¼š${this.dayInfo.solar_term}`)
                        .fontSize(14)
                        .fontColor('#666666')
                        .width('100%')
                      
                      // æ˜¾ç¤ºèŠ‚æ°”ç²¾ç¡®æ—¶åˆ»
                      if (this.dayInfo.solar_term_time) {
                        Row({ space: 4 }) {
                          Text('â° äº¤èŠ‚æ—¶åˆ»ï¼š')
                            .fontSize(13)
                            .fontColor('#999999')
                          Text(SolarTermCalculator.formatSolarTermTime(this.dayInfo.solar_term_time).split(' ')[1])
                            .fontSize(13)
                            .fontWeight(FontWeight.Medium)
                            .fontColor('#D4A574')
                        }
                      }
                    }
                  }
                }
                .width('100%')
                .padding(12)
                .backgroundColor('#ffffff')
                .borderRadius(8)
                .border({ width: 1, color: '#eeeeee' })
              }
            }
            .width('90%')

            // åº•éƒ¨æ“ä½œåŒº
            Column({ space: 12 }) {
              Button() {
                Row({ space: 8 }) {
                  Text('ğŸ”®')
                    .fontSize(20)
                  Text('è¿›å…¥å†æ³•æ¨æ¼”')
                    .fontSize(18)
                    .fontColor('#ffffff')
                }
              }
              .width('100%')
              .height(50)
              .backgroundColor('#D4A574')
              .borderRadius(25)
              .onClick(() => {
                this.navigateToDunjia();
              })

              Text(`åŸºäº ${this.dayInfo.year}.${this.dayInfo.month}.${this.dayInfo.day} ${ShichenHelper.getAllShichen()[this.selectedShichenIndex].name}`)
                .fontSize(12)
                .fontColor('#999999')
                .textAlign(TextAlign.Center)
            }
            .width('90%')
            .padding({ top: 10, bottom: 30 })
          }
        }
        .width('100%')
      }
      .layoutWeight(1)
      .scrollBar(BarState.Off)
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#FAFAFA')
    .bindContentCover(this.showShichenPicker, this.shichenPickerBuilder(), {
      modalTransition: ModalTransition.DEFAULT
    })
  }

  @Builder buildDayCell(dayCell: DayCell) {
    Stack() {
      Text(dayCell.day.toString())
        .fontSize(16)
        .fontColor(dayCell.isCurrentMonth ? '#2C2416' : '#cccccc')
        .fontWeight(this.isSelectedDate(dayCell) ? FontWeight.Bold : FontWeight.Normal)
    }
    .width(`${100/7}%`)
    .height(50)
    .backgroundColor(this.isSelectedDate(dayCell) ? '#E8F4FD' : '#ffffff')
    .border({
      width: this.isSelectedDate(dayCell) ? 2 : 0,
      color: '#4A90E2'
    })
    .borderRadius(6)
    .onClick(() => {
      this.onDaySelected(dayCell);
    })
  }

  @Builder shichenPickerBuilder() {
    Column() {
      Text('é€‰æ‹©æ—¶è¾°')
        .fontSize(18)
        .fontWeight(FontWeight.Bold)
        .padding(16)

      TextPicker({ range: this.shichenTexts, selected: this.selectedShichenIndex })
        .onChange((value: string | string[], index: number | number[]) => {
          if (typeof index === 'number') {
            this.selectedShichenIndex = index;
          }
        })

      Row({ space: 20 }) {
        Button('å–æ¶ˆ')
          .fontSize(16)
          .backgroundColor('#eeeeee')
          .fontColor('#666666')
          .layoutWeight(1)
          .onClick(() => {
            this.showShichenPicker = false;
          })
        
        Button('ç¡®å®š')
          .fontSize(16)
          .backgroundColor('#D4A574')
          .fontColor('#ffffff')
          .layoutWeight(1)
          .onClick(() => {
            this.showShichenPicker = false;
          })
      }
      .width('90%')
      .padding(16)
    }
    .width('100%')
    .padding(20)
    .backgroundColor('#ffffff')
    .borderRadius({ topLeft: 16, topRight: 16 })
  }

  @Builder createInfoCard(title: string, items: string[]) {
    Column({ space: 8 }) {
      Text(title)
        .fontSize(15)
        .fontWeight(FontWeight.Medium)
        .fontColor('#2C2416')
        .width('100%')
      
      ForEach(items, (item: string) => {
        Text(item)
          .fontSize(14)
          .fontColor('#666666')
          .width('100%')
      })
    }
    .width('100%')
    .padding(12)
    .backgroundColor('#ffffff')
    .borderRadius(8)
    .border({ width: 1, color: '#eeeeee' })
  }

  getLunarMonth(): string {
    if (!this.dayInfo) return '';
    const months = ['æ­£æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ', 
                    'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'å†¬æœˆ', 'è…Šæœˆ'];
    return months[this.dayInfo.lunar_month - 1] || `${this.dayInfo.lunar_month}æœˆ`;
  }

  getLunarDay(): string {
    if (!this.dayInfo) return '';
    const days = ['åˆä¸€', 'åˆäºŒ', 'åˆä¸‰', 'åˆå››', 'åˆäº”', 'åˆå…­', 'åˆä¸ƒ', 'åˆå…«', 'åˆä¹', 'åˆå',
                  'åä¸€', 'åäºŒ', 'åä¸‰', 'åå››', 'åäº”', 'åå…­', 'åä¸ƒ', 'åå…«', 'åä¹', 'äºŒå',
                  'å»¿ä¸€', 'å»¿äºŒ', 'å»¿ä¸‰', 'å»¿å››', 'å»¿äº”', 'å»¿å…­', 'å»¿ä¸ƒ', 'å»¿å…«', 'å»¿ä¹', 'ä¸‰å'];
    return days[this.dayInfo.lunar_day - 1] || `${this.dayInfo.lunar_day}æ—¥`;
  }

  getJieqiJieri(): string[] {
    const result: string[] = [];
    if (this.dayInfo?.festivals) {
      result.push(`èŠ‚æ—¥ï¼š${this.dayInfo.festivals}`);
    }
    if (this.dayInfo?.solar_term) {
      result.push(`èŠ‚æ°”ï¼š${this.dayInfo.solar_term}`);
    }
    return result;
  }
}
